# Go

These settings apply only when `--go` is specified on the command line.

``` yaml
#
# Azure OpenAI client generation
#
input-file:
- ./TempTypeSpecFiles/generated.json
output-folder: ../azopenai/internal/azure
clear-output-folder: true
license-header: MICROSOFT_MIT_NO_VERSION
openapi-type: data-plane
go: true
use: "@autorest/go@4.0.0-preview.50"
directive:
  # Add x-ms-parameter-location to parameters in x-ms-parameterized-host
  - from: openapi-document
    where: $.servers.0.variables.endpoint
    debug: true
    transform: $["x-ms-parameter-location"] = "client";
  - from: openapi-document
    where: $.info
    debug: true
    transform: $["title"] = "AzureOpenAI";
  # Make deploymentId a client parameter
  # This must be done in each operation as the parameter is not defined in the components section
  - from: openapi-document
    where: $.paths..parameters..[?(@.name=='deploymentId')]
    transform: $["x-ms-parameter-location"] = "client";

  # Update operationIds to combine all operations into a single client
  - rename-operation:
      from: getCompletions
      to: OpenAI_GetCompletions
  - rename-operation:
      from: getEmbeddings
      to: OpenAI_GetEmbeddings
  - rename-operation:
      from: getChatCompletions
      to: OpenAI_GetChatCompletions

  # Mark request bodies as required (TypeSpec issue #1838)
  - from: openapi-document
    where: $.paths["/deployments/{deploymentId}/completions"].post.requestBody
    transform: $["required"] = true;
  - from: openapi-document
    where: $.paths["/deployments/{deploymentId}/embeddings"].post.requestBody
    transform: $["required"] = true;

  # Remove stream property from CompletionsOptions and ChatCompletionsOptions
  - from: openapi-document
    where: $.components.schemas["CompletionsOptions"]
    transform: delete $.properties.stream;
  - from: openapi-document
    where: $.components.schemas["ChatCompletionsOptions"]
    transform: delete $.properties.stream; 

  # Replace anyOf schemas with an empty schema (no type) to get an "any" type generated
  - from: openapi-document
    where: '$.components.schemas["EmbeddingsOptions"].properties["input"]'
    transform: delete $.anyOf;

  # Fix autorest bug
  - from: openapi-document
    where: $.components.schemas["ChatMessage"].properties.role
    transform: >
      delete $.allOf;
      $["$ref"] = "#/components/schemas/ChatRole";

  # Fix another autorest bug
  - from: openapi-document
    where: $.components.schemas["Choice"].properties.finish_reason
    transform: >
      delete $.oneOf;
      $["$ref"] = "#/components/schemas/CompletionsFinishReason";
  - from: openapi-document
    where: $.components.schemas["ChatChoice"].properties.finish_reason
    transform: >
      delete $.oneOf;
      $["$ref"] = "#/components/schemas/CompletionsFinishReason";

  # Fix "AutoGenerated" models
  - from: openapi-document
    where: $.components.schemas["ChatCompletions"].properties.usage
    transform: >
      delete $.allOf;
      $["$ref"] = "#/components/schemas/CompletionsUsage";
  - from: openapi-document
    where: $.components.schemas["Completions"].properties.usage
    transform: >
      delete $.allOf;
      $["$ref"] = "#/components/schemas/CompletionsUsage";
  - from: 
    - client.go
    - azureopenaiapi_client.go
    where: $
    transform: >-
      return $.replace(
        /(\s+)urlPath\s*:=\s*"\/deployments\/\{deploymentId\}\/([^"]+)".+?url\.PathEscape.+?\n/gs, 
        "$1urlPath := \"$2\"\n")

  # splice out the auto-generated `deploymentID` field from the client
  - from: 
    - client.go
    - azureopenaiapi_client.go
    where: $
    transform: >-
      return $.replace(
        /(type Client struct.+?)deploymentID string([^}]+})/s, 
        "$1$2")

  - from: constants.go
    where: $
    transform: >-
      return $.replace(
        /type ServiceAPIVersions string.+PossibleServiceAPIVersionsValues.+?\n}/gs, 
        "")
  # delete client name prefix from method options and response types
  - from:
      - azureopenaiapi_client.go
      - client.go
      - models.go
      - models_serde.go
      - response_types.go
    where: $
    transform: >
        return $.replace(/AzureOpenAIAPIClient([A-Za-z0-9])/g, "$1")
            .replace(/AzureOpenAIAPIClient/g, "Client")
            .replace(/AzureOpenAIAPI([A-Za-z0-9])/g, "$1");
```
